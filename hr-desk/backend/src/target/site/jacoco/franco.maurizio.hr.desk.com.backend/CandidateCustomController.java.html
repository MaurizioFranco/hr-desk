<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CandidateCustomController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">hr-desk.backend17</a> &gt; <a href="index.source.html" class="el_package">franco.maurizio.hr.desk.com.backend</a> &gt; <span class="el_source">CandidateCustomController.java</span></div><h1>CandidateCustomController.java</h1><pre class="source lang-java linenums">package franco.maurizio.hr.desk.com.backend;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import franco.maurizio.hr.desk.com.persistence.entity.CeReProAbstractEntity;
import franco.maurizio.hr.desk.com.persistence.entity.custom.CandidateCustom;
import franco.maurizio.hr.desk.com.persistence.entity.custom.CustomErrorType;
import franco.maurizio.hr.desk.com.persistence.entity.custom.ListedCandidateCustom;
import franco.maurizio.hr.desk.com.rest.request.candidate.RequestCandidateCustom;
import franco.maurizio.hr.desk.com.rest.request.candidate.RequestUpdateCandidateCustom;
import franco.maurizio.hr.desk.com.service.CandidateService;
import franco.maurizio.hr.desk.com.service.exception.CandidateNotFoundException;

/**
 * 
 * @author maurizio.franco@ymail.com
 * 
 */
@RestController
@RequestMapping(&quot;/api/v1/candidatecustom&quot;)
<span class="fc" id="L36">public class CandidateCustomController {</span>
	
	@Autowired
	private CandidateService candidateService;

<span class="fc" id="L41">	public static final Logger logger = LoggerFactory.getLogger(CandidateCustomController.class);</span>
//	@Autowired
//	private UserRepository userRepository;
//	@Autowired
//	private RoleRepository roleRepository;
//	@Autowired
//	private UserSurveyTokenRepository userSurveyTokenRepository;
//	@Autowired
//	private SurveyReplyRepository surveyReplyRepository;
	

//	/**
//	 * getAllCandidateCustom method gets all candidates custom
//	 * 
//	 * COMMENTED ON 24/01/20 because no more used!!!!!!!! by maurizio
//	 * 
//	 * @return a new ResponseEntity with the given status code
//	 */
//	@GetMapping(&quot;/&quot;)
//	public ResponseEntity&lt;List&lt;CandidateCustom&gt;&gt; getAllCandidateCustom() {
//		List&lt;CandidateCustom&gt; candidates = candidateService.getAllCustom();
//		if (candidates.isEmpty()) {
//			return new ResponseEntity&lt;List&lt;CandidateCustom&gt;&gt;(HttpStatus.NO_CONTENT);
//		} else
//			return new ResponseEntity&lt;List&lt;CandidateCustom&gt;&gt;(candidates, HttpStatus.OK);
//	}

	/******* PAGEABLE ********/

	
	/**
	 * Method called from frontend, when user DOESN'T select a particular course code or a job code.
	 * 
	 * Provides a paginated list of candidate filtered by pagination info.
	 *  
	 * @param size
	 * @param number
	 * @return
	 */
	@GetMapping(&quot;/paginated/{size}/{number}/&quot;)
	public ResponseEntity&lt;Page&lt;ListedCandidateCustom&gt;&gt; getPaginatedCandidate(@PathVariable final int size,
            @PathVariable final int number) {
		//Page&lt;CandidateCustom&gt; cC = candidateService.getAllCustomPaginated(PageRequest.of(number, size, Sort.Direction.ASC, &quot;id&quot;));
<span class="nc" id="L84">		Page&lt;ListedCandidateCustom&gt; cC = candidateService.getAllCustomPaginatedByCourseCode(PageRequest.of(number, size), null);</span>
<span class="nc bnc" id="L85" title="All 2 branches missed.">		if (cC.isEmpty()) {</span>
<span class="nc" id="L86">			return new ResponseEntity&lt;&gt;(HttpStatus.NO_CONTENT);</span>
		}
<span class="nc" id="L88">		return new ResponseEntity&lt;Page&lt;ListedCandidateCustom&gt;&gt;(cC, HttpStatus.OK);</span>
	}
	
	/**
	 * Method called from frontend, when user select a particular course code or a job code.
	 * 
	 * Provides a paginated list of candidate filtered by course code, and pagination info.
	 *  
	 * @param size
	 * @param number
	 * @param code
	 * @return paginated list of candidate filtered by course code, and pagination info
	 * 
	 */
	@GetMapping(&quot;/paginated/{size}/{number}/{code}&quot;)
	public ResponseEntity&lt;Page&lt;ListedCandidateCustom&gt;&gt; getAllCustomCandidatesPaginatedByCode(@PathVariable final int size,
            @PathVariable final int number,@PathVariable final String code) {
		//commented to allow ordering by candidacy_date_time
		//Page&lt;CandidateCustom&gt; cC = candidateService.getAllCustomPaginatedByCourseCode(PageRequest.of(number, size, Sort.Direction.ASC, &quot;id&quot;),courseCode);
<span class="nc" id="L107">		Page&lt;ListedCandidateCustom&gt; cC = candidateService.getAllCustomPaginatedByCourseCode(PageRequest.of(number, size),code);</span>
<span class="nc bnc" id="L108" title="All 2 branches missed.">		if (cC.isEmpty()) {</span>
<span class="nc" id="L109">			return new ResponseEntity&lt;&gt;(HttpStatus.NO_CONTENT);</span>
		}
<span class="nc" id="L111">		return new ResponseEntity&lt;Page&lt;ListedCandidateCustom&gt;&gt;(cC, HttpStatus.OK);</span>
	}

	/**
	 * getCandidateCustomById method gets a candidateCustom by id
	 * 
	 * @param id of the candidateCustom to be selected
	 * @return a new ResponseEntity with the given status code
	 */
	@GetMapping(&quot;/{id}&quot;)
	public ResponseEntity&lt;CeReProAbstractEntity&gt; getCandidateCustomById(@PathVariable final Long id) {
<span class="fc" id="L122">		logger.info(&quot;getCandidateCustomById - START - with id: {}&quot;, id);</span>
<span class="fc" id="L123">		CandidateCustom candidateCustom = candidateService.getCustomById(id);</span>
<span class="fc bfc" id="L124" title="All 2 branches covered.">		if (candidateCustom == null) {</span>
//			return new ResponseEntity&lt;&gt;(new CustomErrorType(&quot;candidateCustom with id &quot; + id + &quot; not found&quot;),
//					HttpStatus.NOT_FOUND);
<span class="fc" id="L127">			return new ResponseEntity&lt;&gt;(HttpStatus.NO_CONTENT);</span>
		}

<span class="fc" id="L130">		return new ResponseEntity&lt;&gt;(candidateCustom, HttpStatus.OK);</span>
	}
	
	/*
	 * COMMENTED BECAUSE FOR NOW, NOT USED ---&gt; maurizio
	@GetMapping(&quot;/code/{code}&quot;)
	public ResponseEntity&lt;List&lt;ListedCandidateCustom&gt;&gt; listAllCandidateByCode(@PathVariable(&quot;code&quot;) final String code) {
		logger.info(&quot;started&quot;);
		List&lt;ListedCandidateCustom&gt; candidates = candidateService.getAllByCourseCode(code);
//		logger.info(candidates.get(0).getCourseCode());
		if (candidates.isEmpty()) {     			
			return new ResponseEntity&lt;&gt;(HttpStatus.NO_CONTENT);
		}else
			return new ResponseEntity&lt;List&lt;ListedCandidateCustom&gt;&gt;(candidates, HttpStatus.OK);
	}
	*/
	
	

	/**
	 * Provides to create a new candidate from a given RequestCandidateCustom
	 * 
	 * @param requestCandidateCustom, RequestCandidateCustom instance to keep field to insert for a new Candidate entity to insert.
	 * @return ResponseEntity instance with the status code
	 */
	//COMENTED----&gt; OLD VERSION
//	@Transactional
//	@PostMapping(value = &quot;/&quot;)
//	public ResponseEntity&lt;CeReProAbstractEntity&gt; createCandidateCustom(@ModelAttribute final RequestCandidateCustom candidateCustom) {
//		logger.info(&quot;Creating candidateCustom : {}&quot;, candidateCustom);
//		
//		if (roleRepository.findByLevel(Role.JAVA_COURSE_CANDIDATE_LEVEL) == null) {
//
//			return new ResponseEntity&lt;&gt;(
//					new CustomErrorType(&quot;Unable to create new Candidate. Level &quot; + Role.JAVA_COURSE_CANDIDATE_LEVEL + &quot; is not present in database.&quot;),
//					HttpStatus.CONFLICT);
//		}
//		User user = null ;
//		Optional&lt;User&gt; optUser = userRepository.findByEmail(candidateCustom.getEmail()) ;
//		if (optUser.isPresent()) {
//			user = optUser.get();
//			return new ResponseEntity&lt;&gt;(new CustomErrorType(&quot;Unable to create new user. A Candidate with email &quot;
//					+ candidateCustom.getEmail() + &quot; already exist.&quot;), HttpStatus.CONFLICT);
//		} else { 
//
//
//			user = new User();
//	
//			user.setEmail(candidateCustom.getEmail());
//			user.setFirstname(candidateCustom.getFirstname());
//			user.setLastname(candidateCustom.getLastname());
//			user.setNote(candidateCustom.getNote());
//			System.out.println(&quot;Local date time: &quot; + candidateCustom.getDateOfBirth());
//			Date inputDate = candidateCustom.getDateOfBirth();
//	
//			if (inputDate != null) {
//				SimpleDateFormat formatter = new SimpleDateFormat(&quot;dd-MMM-yyyy&quot;);
//				String inputStringDate = formatter.format(inputDate);
//				System.out.println(&quot;inputStringDate &quot; + inputStringDate);
//	
//				if (inputStringDate.equals(&quot;11-nov-1111&quot;)) {
//					user.setDateOfBirth(null);
//				} else {
//					LocalDate dateToDB = inputDate.toInstant().atZone(ZoneId.systemDefault()).toLocalDate();
//					user.setDateOfBirth(dateToDB);
//				}
//			}
//			user.setRegdate(LocalDateTime.now());
//			user.setRole(Role.JAVA_COURSE_CANDIDATE_LEVEL);
//	
//			//User userforCandidate = userRepository.save(user);
//			userRepository.save(user);
//		}
//
//		if (candidateCustom.getImgpath() != null) {
//
//			try {
//				String[] nameIdData = saveUploadedFiles(candidateCustom.getFiles(), user.getId().toString());
//				logger.info(&quot;nameIdData:&quot; + nameIdData[0]);
//				user.setImgpath(nameIdData[0]);
//				//userforCandidate = userRepository.save(user);
//				userRepository.save(user);
//			} catch (IOException e) {
//				logger.error(&quot;Error&quot;, e);
//			}
//
//		}
//
//		Candidate candidate = new Candidate();
//
////		candidate.setUserId(userforCandidate.getId());
//		candidate.setUserId(user.getId());
//		candidate.setDomicileCity(candidateCustom.getDomicileCity());
////		candidate.setDomicileHouseNumber(candidateCustom.getDomicileHouseNumber());
////		candidate.setDomicileStreetName(candidateCustom.getDomicileStreetName());
//		candidate.setStudyQualification(candidateCustom.getStudyQualification());
//		candidate.setGraduate(candidateCustom.getGraduate());
//		candidate.setHighGraduate(candidateCustom.getHighGraduate());
//		candidate.setStillHighStudy(candidateCustom.getStillHighStudy());
//		candidate.setMobile(candidateCustom.getMobile());
//		candidate.setCourseCode(coursePageService.checkCoursePageCode(candidateCustom.getCourseCode()));
//		//TODO: AGGIUNGERE UN CONTROLLO SUL COURSE CODE SE NON è PRESENTE NEL DATABASE METTERNE UNO DI DEFAULT --&gt; candidatura generica!!!!
////		candidate.setNote(candidateCustom.getNote());
//		candidate.setCandidacyDateTime(LocalDateTime.now());
//		if (candidateCustom.getCvExternalPath() != null) {
//
//			try {
//
//				String[] nameIdData = saveUploadedFiles(candidateCustom.getFiles(), user.getId().toString());
//				logger.info(&quot;nameIdData:&quot; + nameIdData[1]);
//				candidate.setCvExternalPath(nameIdData[1]);
//			} catch (IOException e) {
//				logger.error(&quot;Error&quot;, e);
//			}
//		}
//
//		candidateService.insert(candidate);
//
//		logger.info(&quot;END POST&quot;);
//		return new ResponseEntity&lt;&gt;(candidate, HttpStatus.CREATED);
//
//	}	
	@Transactional
	@PostMapping(value = &quot;/&quot;)
	//public ResponseEntity&lt;CeReProAbstractEntity&gt; insert(@ModelAttribute final RequestCandidateCustom requestCandidateCustom) {
	public ResponseEntity&lt;CeReProAbstractEntity&gt; insert(@ModelAttribute RequestCandidateCustom requestCandidateCustom) {
<span class="nc" id="L256">		logger.info(&quot;insert : {}&quot;, requestCandidateCustom);</span>
<span class="nc" id="L257">		CeReProAbstractEntity objToReturn = null ;</span>
		try {
<span class="nc" id="L259">			objToReturn = candidateService.createNewCandidate(requestCandidateCustom);</span>
<span class="nc" id="L260">			return new ResponseEntity&lt;CeReProAbstractEntity&gt;(objToReturn, HttpStatus.CREATED);</span>
<span class="nc" id="L261">		} catch (Exception e) {</span>
<span class="nc" id="L262">			logger.error(e.getMessage());</span>
<span class="nc" id="L263">			logger.error(&quot;ERROR in inserting new candidate: &quot;, e);</span>
//			return new ResponseEntity&lt;&gt;(HttpStatus.BAD_REQUEST);
<span class="nc" id="L265">			return new ResponseEntity&lt;CeReProAbstractEntity&gt;(new CustomErrorType(&quot;Unable to insert new candidate: &quot; + requestCandidateCustom)  , HttpStatus.BAD_REQUEST);</span>
		}

//		logger.info(&quot;END POST&quot;);
		// return new ResponseEntity&lt;&gt;(candidate, HttpStatus.CREATED);

	}	


	/**
	 * updateCandidateCustom method updates a candidate custom
	 * 
	 * @param id   of the user to be updated
	 * @param user with the fields updated
	 * @return a new ResponseEntity with the given status code
	 */
	@Transactional
	@PutMapping(value = &quot;/{id}&quot;)
	public ResponseEntity&lt;CeReProAbstractEntity&gt; update(@PathVariable Long id,
			@ModelAttribute RequestUpdateCandidateCustom candidateCustom) {
//		System.out.println(&quot;####### Updating candidateCustom : {}&quot; + candidateCustom);
<span class="nc" id="L286">		logger.info(&quot;update: {} for id: {}&quot;, candidateCustom, id);</span>
<span class="nc" id="L287">		CeReProAbstractEntity objToReturn = null ;</span>
		try {
<span class="nc" id="L289">			objToReturn = candidateService.updateCandidate(id, candidateCustom);</span>
<span class="nc" id="L290">			return new ResponseEntity&lt;CeReProAbstractEntity&gt;(objToReturn, HttpStatus.OK);</span>
<span class="nc" id="L291">		} catch (CandidateNotFoundException e) {</span>
<span class="nc" id="L292">			logger.error(e.getMessage());</span>
<span class="nc" id="L293">			logger.error(&quot;ERROR in updating candidate, Candidate not found: &quot;, e);</span>
<span class="nc" id="L294">			return new ResponseEntity&lt;CeReProAbstractEntity&gt;(new CustomErrorType(&quot;Candidate not found. Unable to update candidate: &quot; + candidateCustom)  , HttpStatus.NO_CONTENT);		</span>
<span class="nc" id="L295">		} catch (Exception e) {</span>
<span class="nc" id="L296">			logger.error(e.getMessage());</span>
<span class="nc" id="L297">			logger.error(&quot;ERROR in updating candidate: &quot;, e);</span>
<span class="nc" id="L298">			return new ResponseEntity&lt;CeReProAbstractEntity&gt;(new CustomErrorType(&quot;Unable to update candidate: &quot; + candidateCustom)  , HttpStatus.BAD_REQUEST);</span>
		}
//		ObjectMapper objectMapper = new ObjectMapper();
//
//		objectMapper.setVisibility(PropertyAccessor.ALL, Visibility.NONE);
//		objectMapper.setVisibility(PropertyAccessor.FIELD, Visibility.ANY);

//		boolean imgIsPresent = false;
//		boolean cvIsPresent = false;

//		if (candidateCustom == null) {
//			return new ResponseEntity&lt;&gt;(
//					new CustomErrorType(&quot;Unable to update. candidateCustom with id &quot; + id + &quot; not found.&quot;),
//					HttpStatus.NOT_FOUND);
//		}
//
//		System.out.println(&quot;############ PUT ENTRATO: &quot;);
//		System.out.println(candidateCustom.getUserId());

//		CandidateCustom candidateCurrentCustom = candidateRepository.getSingleCustomCandidate(id);

//		Optional&lt;User&gt; optUser = userRepository.findById(candidateCustom.getUserId());

//		User currentUser = optUser.get();
//
//		currentUser.setEmail(candidateCustom.getEmail());
//		currentUser.setFirstname(candidateCustom.getFirstname());
//		logger.info(&quot;candidateCustom.getFirstname() : {}&quot;, candidateCustom.getFirstname());
//		currentUser.setLastname(candidateCustom.getLastname());
//		currentUser.setNote(candidateCustom.getNote());
//		Date inputDate = candidateCustom.getDateOfBirth();
//		if (inputDate != null) {
//			LocalDate dateToDB = inputDate.toInstant().atZone(ZoneId.systemDefault()).toLocalDate();
//			currentUser.setDateOfBirth(dateToDB);
//		}
//
//		System.out.println(&quot;OLDIMG: &quot; + candidateCustom.getOldImg());
//		System.out.println(&quot;NewIMG: &quot; + candidateCustom.getImgpath());
//		String oldImg = candidateCustom.getOldImg();
//		String newImg = candidateCustom.getImgpath();
//
//		// se si oldImg e si newImg
//		if (newImg != null &amp;&amp; !oldImg.equals(&quot;null&quot;) &amp;&amp; !newImg.equals(&quot;null&quot;)) {
////			imgIsPresent = true;
////			String imgPath = &quot;img/&quot; +candidateCustom.getUserId()+candidateCustom.getImgpath();
//			try {
//
//				// save newImg
//				String[] nameIdData = candidateService.uploadFile(candidateCustom.getFiles(),
//						candidateCustom.getUserId().toString());
//				logger.info(&quot;nameIdData:&quot; + nameIdData[0]);
//				currentUser.setImgpath(nameIdData[0]);
//
//				// delete oldImg
//				String sPath = candidateService.IMG_DIR + File.separatorChar + candidateCustom.getOldImg();
//				Path path = Paths.get(sPath);
//				Files.delete(path);
//
//			} catch (IOException e) {
//				logger.error(&quot;Error&quot;, e);
//			}
//
//		}
//
//		// se no oldImg si newImg
//		if (newImg != null &amp;&amp; oldImg.equals(&quot;null&quot;) &amp;&amp; !newImg.equals(&quot;null&quot;)) {
////			imgIsPresent = true;
////			String imgPath = &quot;img/&quot; +candidateCustom.getUserId()+ candidateCustom.getImgpath();
//
//			try {
//
//				// save firstNewImg
//				String[] nameIdData = candidateService.uploadFile(candidateCustom.getFiles(),
//						candidateCustom.getUserId().toString());
//				logger.info(&quot;nameIdData:&quot; + nameIdData[0]);
//				currentUser.setImgpath(nameIdData[0]);
//
//			} catch (IOException e) {
//				logger.error(&quot;Error&quot;, e);
//			}
//
//		}

//		logger.info(&quot;Update currentUser : {}&quot;, currentUser.toString());
//		userRepository.save(currentUser);
//
//		Optional&lt;Candidate&gt; candidate = candidateService.getById(id);
//
//		Candidate currentCandidate = candidate.get();
//		currentCandidate.setDomicileCity(candidateCustom.getDomicileCity());
////		currentCandidate.setDomicileHouseNumber(candidateCustom.getDomicileHouseNumber());
////		currentCandidate.setDomicileStreetName(candidateCustom.getDomicileStreetName());
//		currentCandidate.setStudyQualification(candidateCustom.getStudyQualification());
//		currentCandidate.setGraduate(candidateCustom.getGraduate());
//		currentCandidate.setHighGraduate(candidateCustom.getHighGraduate());
//		currentCandidate.setStillHighStudy(candidateCustom.getStillHighStudy());
//		currentCandidate.setMobile(candidateCustom.getMobile());
//		currentCandidate.setCandidateStatusCode(candidateCustom.getCandidateStatesId());
//		
//		//System.out.println(&quot;candidateStatesId: &quot;+currentCandidate.getCandidateStatesId());
//		//System.out.println(&quot;OLDCV: &quot; + candidateCustom.getOldCV());
//		//System.out.println(&quot;NewCV: &quot; + candidateCustom.getCvExternalPath());
//		String oldCV = candidateCustom.getOldCV();
//		String newCV = candidateCustom.getCvExternalPath();
//
//		// se si oldCV si newCV
//		if (newCV != null &amp;&amp; !oldCV.equals(&quot;null&quot;) &amp;&amp; !newCV.equals(&quot;null&quot;)) {
////			cvIsPresent = true;
////			String cvPath = &quot;curriculumvitae/&quot; +candidateCustom.getUserId()+ candidateCustom.getCvExternalPath();
//
//			try {
//
//				// save newCv
//				String[] nameIdData = candidateService.uploadFile(candidateCustom.getFiles(),
//						candidateCustom.getUserId().toString());
//				logger.info(&quot;nameIdData:&quot; + nameIdData[1]);
//				currentCandidate.setCvExternalPath(nameIdData[1]);
//
//				// delete oldCV
//				String sPath = candidateService.CV_DIR + File.separatorChar + candidateCustom.getOldCV();
//				Path path = Paths.get(sPath);
//				Files.delete(path);
//
//			} catch (IOException e) {
//				logger.error(&quot;Error&quot;, e);
//			}
//
//		}
//
//		// se no oldCV si newCV
//		if (newCV != null &amp;&amp; oldCV.equals(&quot;null&quot;) &amp;&amp; !newCV.equals(&quot;null&quot;)) {
////			cvIsPresent = true;
////			String cvPath = &quot;curriculumvitae/&quot; +candidateCustom.getUserId()+ candidateCustom.getCvExternalPath();
//
//			try {
//
//				// save firstCV
//				String[] nameIdData = candidateService.uploadFile(candidateCustom.getFiles(),
//						candidateCustom.getUserId().toString());
//				logger.info(&quot;nameIdData:&quot; + nameIdData[1]);
//				currentCandidate.setCvExternalPath(nameIdData[1]);
//
//			} catch (IOException e) {
//				logger.error(&quot;Error&quot;, e);
//			}
//
//		}
		
//		//System.out.println(&quot;Prima di essere salvato candidateStatesId: &quot;+currentCandidate.getCandidateStatesId());
//		
//		candidateService.update(currentCandidate);
//        
//		//System.out.println(&quot;Dopo essere salvato candidateStatesId: &quot;+currentCandidate.getCandidateStatesId());
//		//logger.info(&quot;Prima della fine della PUT.........................................................................................&quot;);
//		logger.info(&quot;END PUT&quot;);
//		return new ResponseEntity&lt;&gt;(candidateCustom, HttpStatus.OK);
		
		
		
		
		
	}

	/**
	 * Provides to delete candidate from database and cv and profile img files from file system.
	 * 
	 * @param id of the candidate to delete
	 * 
	 * @return a new ResponseEntity with the given status code
	 */
	@Transactional
	@DeleteMapping(&quot;/{id}&quot;)
	public ResponseEntity&lt;CeReProAbstractEntity&gt; delete(@PathVariable final Long id) {
<span class="nc" id="L471">		logger.info(&quot;delete - START - for id: {}&quot;, id);</span>
		try {
<span class="nc" id="L473">			candidateService.deleteCandidate(id);</span>
<span class="nc" id="L474">			return new ResponseEntity&lt;&gt;(HttpStatus.NO_CONTENT);</span>
<span class="nc" id="L475">		} catch (CandidateNotFoundException e) {</span>
<span class="nc" id="L476">			logger.error(e.getMessage());</span>
<span class="nc" id="L477">			logger.error(&quot;ERROR in updating candidate, Candidate not found: &quot;, e);</span>
<span class="nc" id="L478">			return new ResponseEntity&lt;CeReProAbstractEntity&gt;(new CustomErrorType(&quot;Candidate not found. Unable to delete candidate with id: &quot; + id)  , HttpStatus.BAD_REQUEST);		</span>
<span class="nc" id="L479">		} catch (Exception e) {</span>
<span class="nc" id="L480">			logger.error(e.getMessage());</span>
<span class="nc" id="L481">			logger.error(&quot;ERROR in updating candidate: &quot;, e);</span>
<span class="nc" id="L482">			return new ResponseEntity&lt;CeReProAbstractEntity&gt;(new CustomErrorType(&quot;Unable to delete candidate with id: &quot; + id)  , HttpStatus.CONFLICT);</span>
		}
		
//		logger.info(&quot;DELETE CANDIDATE CUSTOM - START&quot;);
//		Optional&lt;Candidate&gt; candidateOpt = candidateService.getById(id);
//		logger.info(&quot;candidateOpt &quot; + candidateOpt);
//		if (!candidateOpt.isPresent()) {
//			logger.info(&quot;candidate not present &quot; + candidateOpt);
//			return new ResponseEntity&lt;&gt;(
//					new CustomErrorType(&quot;Unable to delete. Candidate with id &quot; + id + &quot; not found.&quot;),
//					HttpStatus.NOT_FOUND);
//		}
//
//		Candidate currentCandidate = candidateOpt.get();
//		logger.info(&quot;Deleting user with user id: &quot; + currentCandidate.getUserId());
//		logger.info(&quot;candidate id &quot; + currentCandidate.getUserId());
//		List&lt;UserTokenSurvey&gt; userTokenSurvey = userSurveyTokenRepository.findByUserId(currentCandidate.getUserId());
//		logger.info(&quot;####################### LIST #########&quot; + userTokenSurvey.toString());
//
////		Optional&lt;SurveyReply&gt; surveyReplyOpt = surveyReplyRepository.findById(id); 
////		logger.info(&quot;####### surveyReplyOpt  ########&quot;+surveyReplyOpt);
//		List&lt;SurveyReply&gt; surveyReply = surveyReplyRepository.findByUserId(currentCandidate.getUserId());
//		logger.info(&quot;####################### LIST &lt;SurveyReply&gt; surveyReply #########&quot; + surveyReply.toString());
//		if (!userTokenSurvey.isEmpty()) {
//			return new ResponseEntity&lt;&gt;(
//					new CustomErrorType(&quot;Unable to delete. User with id &quot; + id + &quot; is userTokenSurvey referenced.&quot;),
//					HttpStatus.CONFLICT); // code 409
//
//		} else if (!surveyReply.isEmpty()) {
//			return new ResponseEntity&lt;&gt;(new CustomErrorType(&quot;Non è possibile cancellare l'utente con id: &quot; + id
//					+ &quot; in quanto esiste almeno un questionario associato ad esso.&quot;), HttpStatus.CONFLICT); // code 409
//
//		} else {
//			logger.info(&quot;####################### &quot;);
//			logger.info(&quot;Deleting candidate with id: &quot; + id);
//			candidateService.deleteById(id);
//
//			Optional&lt;User&gt; userOpt = userRepository.findById(currentCandidate.getUserId());
//			userRepository.deleteById(currentCandidate.getUserId());
//
//			if (userOpt.get().getImgpath() != null) {
//
//				String sPath = candidateService.IMG_DIR + File.separatorChar + userOpt.get().getImgpath();
//				Path path = Paths.get(sPath);
//				try {
//					Files.delete(path);
//				} catch (IOException e) {
//					logger.error(&quot;Error&quot;, e);
//				}
//			}
//
//			if (currentCandidate.getCvExternalPath() != null) {
//
//				String sPath = candidateService.CV_DIR + File.separatorChar + currentCandidate.getCvExternalPath();
//				Path path = Paths.get(sPath);
//				try {
//					Files.delete(path);
//				} catch (IOException e) {
//					logger.error(&quot;Error&quot;, e);
//				}
//			}
//
//			return new ResponseEntity&lt;&gt;(HttpStatus.NO_CONTENT);
//		}

	}

//	//COMMENTED BECAUSE NO MORE USED --&gt; MAurizio --&gt; 20200506
//	/**
//	 * @author daniele
//	 * 
//	 *         createCandidateCustom method creates a candidate
//	 *         
//	 *         
//	 *         USED BY REACT FRONTEND!!!!!!!!!!!!!!!!!
//	 * 
//	 * @param candidate to be created
//	 * @return a new ResponseEntity with the given status code
//	 */
//	@Transactional
//	@PostMapping(value = &quot;/field/&quot;)
//	public ResponseEntity&lt;?&gt; createFieldCandidateCustom(@RequestBody final CandidateCustom candidateCustom) {
//
//		if (roleRepository.findByLevel(90) == null) {
//			return new ResponseEntity&lt;&gt;(
//					new CustomErrorType(&quot;Unable to create new Candidate. Level &quot; + 90 + &quot; is not present in database.&quot;),
//					HttpStatus.CONFLICT);
//		}
//
//		if (userRepository.findByEmail(candidateCustom.getEmail()).isPresent()) {
//			return new ResponseEntity&lt;&gt;(new CustomErrorType(&quot;Unable to create new candidate. A user with email &quot;
//					+ candidateCustom.getEmail() + &quot; already exist.&quot;), HttpStatus.CONFLICT);
//		} else {
//			User user = new User();
//
//			user.setEmail(candidateCustom.getEmail());
//			user.setFirstname(candidateCustom.getFirstname());
//			user.setLastname(candidateCustom.getLastname());
//			user.setDateOfBirth(candidateCustom.getDateOfBirth());
//			user.setRegdate(LocalDateTime.now());
//			user.setRole(90);
//
//			User userforCandidate = userRepository.save(user);
//			Candidate candidate = new Candidate();
//
//			candidate.setUserId(userforCandidate.getId());
//			candidate.setDomicileCity(candidateCustom.getDomicileCity());
////			candidate.setDomicileHouseNumber(candidateCustom.getDomicileHouseNumber());
////			candidate.setDomicileStreetName(candidateCustom.getDomicileStreetName());
//			candidate.setStudyQualification(candidateCustom.getStudyQualification());
//			candidate.setGraduate(candidateCustom.getGraduate());
//			candidate.setHighGraduate(candidateCustom.getHighGraduate());
//			candidate.setStillHighStudy(candidateCustom.getStillHighStudy());
//			candidate.setMobile(candidateCustom.getMobile());
//			candidate.setCandidacyDateTime(LocalDateTime.now());
//			candidateService.insert(candidate);
//
//			return new ResponseEntity&lt;&gt;(candidate, HttpStatus.CREATED);
//		}
//	}

	
//	//COMMENTED BECAUSE NO MORE USED --&gt; MAurizio --&gt; 20200506
//	/**
//	 * @author daniele
//	 * 
//	 *         updateCandidateCustom method updates a candidate custom
//	 *         
//	 *         USED BY REACT FRONTEND!!!!!!!!!!!!!!!!!
//	 * 
//	 * @param id   of the user to be updated
//	 * @param user with the fields updated
//	 * @return a new ResponseEntity with the given status code
//	 */
//	@PutMapping(value = &quot;/field/{id}&quot;)
//	public ResponseEntity&lt;CeReProAbstractEntity&gt; updateFieldCandidateCustom(@PathVariable(&quot;id&quot;) final Long id,
//			@RequestBody final CandidateCustom candidateCustom) {
//		if (candidateCustom == null) {
//			return new ResponseEntity&lt;&gt;(
//					new CustomErrorType(&quot;Unable to update. candidateCustom with id &quot; + id + &quot; not found.&quot;),
//					HttpStatus.NOT_FOUND);
//		} else {
//
//			Optional&lt;User&gt; optUser = userRepository.findById(candidateCustom.getUserId());
//
//			if (!optUser.isPresent()) {
//				return new ResponseEntity&lt;&gt;(
//						new CustomErrorType(
//								&quot;Unable to update. user with id &quot; + candidateCustom.getUserId() + &quot; not found.&quot;),
//						HttpStatus.NOT_FOUND);
//			} else {
//				User currentUser = optUser.get();
//
//				currentUser.setEmail(candidateCustom.getEmail());
//				currentUser.setFirstname(candidateCustom.getFirstname());
//				currentUser.setLastname(candidateCustom.getLastname());
//				currentUser.setDateOfBirth(candidateCustom.getDateOfBirth());
//
//				userRepository.save(currentUser);
//
//				Optional&lt;Candidate&gt; optCandidate = candidateService.getById(id);
//
//				if (!optCandidate.isPresent()) {
//					return new ResponseEntity&lt;&gt;(
//							new CustomErrorType(&quot;Unable to update. candidate with id &quot; + id + &quot; not found.&quot;),
//							HttpStatus.NOT_FOUND);
//				} else {
//					Candidate currentCandidate = optCandidate.get();
//					currentCandidate.setDomicileCity(candidateCustom.getDomicileCity());
////					currentCandidate.setDomicileHouseNumber(candidateCustom.getDomicileHouseNumber());
////					currentCandidate.setDomicileStreetName(candidateCustom.getDomicileStreetName());
//					currentCandidate.setStudyQualification(candidateCustom.getStudyQualification());
//					currentCandidate.setGraduate(candidateCustom.getGraduate());
//					currentCandidate.setHighGraduate(candidateCustom.getHighGraduate());
//					currentCandidate.setStillHighStudy(candidateCustom.getStillHighStudy());
//					currentCandidate.setMobile(candidateCustom.getMobile());
//					//currentCandidate.setCandidateStatesId(candidateCustom.getCandidateStatesId());
//					
//					
//					//System.out.println(&quot;Sei anche qua&quot;);
//					candidateService.insert(currentCandidate);
//					return new ResponseEntity&lt;&gt;(candidateCustom, HttpStatus.OK);
//				}
//			}
//		}
//	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>