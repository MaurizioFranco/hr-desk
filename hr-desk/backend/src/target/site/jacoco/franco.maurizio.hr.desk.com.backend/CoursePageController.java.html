<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CoursePageController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">hr-desk.backend17</a> &gt; <a href="index.source.html" class="el_package">franco.maurizio.hr.desk.com.backend</a> &gt; <span class="el_source">CoursePageController.java</span></div><h1>CoursePageController.java</h1><pre class="source lang-java linenums">package franco.maurizio.hr.desk.com.backend;

import java.io.File;
import java.io.FileNotFoundException;
import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.cache.annotation.CacheEvict;
import org.springframework.cache.annotation.Cacheable;
import org.springframework.context.MessageSource;
import org.springframework.context.i18n.LocaleContextHolder;
import org.springframework.dao.DataIntegrityViolationException;
import org.springframework.data.domain.Sort;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import franco.maurizio.hr.desk.com.persistence.entity.CeReProAbstractEntity;
import franco.maurizio.hr.desk.com.persistence.entity.CoursePage;
import franco.maurizio.hr.desk.com.persistence.entity.custom.CoursePageCustom;
import franco.maurizio.hr.desk.com.persistence.entity.custom.CustomErrorType;
import franco.maurizio.hr.desk.com.persistence.repository.coursepage.CoursePageRepository;
import franco.maurizio.hr.desk.com.service.CoursePageService;
import jakarta.validation.Valid;

/**
 * 
 * 
 * @author Traian Cojocariu
 * @author Orlando Plat√¨
 * @author Sebastiano Varchetta
 *
 */

@RestController
@RequestMapping(&quot;/api/v1/coursepage&quot;)
<span class="fc" id="L50">public class CoursePageController {</span>
	
	@Autowired
	private MessageSource messageSource;
	
<span class="fc" id="L55">	final String FINE_INDEX = &quot;\n&lt;/body&gt;\r\n&quot; + &quot;&lt;/html&gt;\r\n&quot; + &quot;&quot;;</span>
//	static final String START_MESSAGE_BODY=&quot;&lt;!DOCTYPE html&gt;\r\n&quot; + 
//			&quot;&lt;html lang=\&quot;it\&quot; ng-app=\&quot;candidating\&quot;&gt;\r\n&quot; + 
//			&quot;&lt;head&gt;\r\n&quot; + 
//			&quot;\r\n&quot; + 
//			&quot;&lt;meta charset=\&quot;utf-8\&quot;&gt;\r\n&quot; + 
//			&quot;    &lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1, shrink-to-fit=no\&quot;&gt;\r\n&quot; + 
//			&quot;    &lt;meta name=\&quot;author\&quot; content=\&quot;m.franco@proximainformatica.com\&quot;&gt;\r\n&quot; + 
//			&quot;    &lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1\&quot;&gt;\r\n&quot; + 
//			&quot;	&lt;meta charset=\&quot;UTF-8\&quot;&gt;\r\n&quot; + 
//			&quot;	&lt;title&gt;Candidati - Corso Java - Proxima Informatica&lt;/title&gt;\r\n&quot; + 
//			&quot;	&lt;meta name=\&quot;description\&quot;\r\n&quot; + 
//			&quot;		content=\&quot;Corso Java gratuito professionalizzante su Roma e Milano. A fine corso contratto a tempo indeterminato (placement 70%). Invia subito il tuo cv!\&quot; /&gt;	\r\n&quot; + 
//			&quot;	&lt;link rel=\&quot;icon\&quot; href=\&quot;http://www.proximainformatica.com/wp-content/uploads/2017/09/cropped-favicon-fb-proxima-3-32x32.png\&quot; sizes=\&quot;32x32\&quot; /&gt;\r\n&quot; + 
//			&quot;	&lt;link rel=\&quot;icon\&quot; href=\&quot;http://www.proximainformatica.com/wp-content/uploads/2017/09/cropped-favicon-fb-proxima-3-192x192.png\&quot; sizes=\&quot;192x192\&quot; /&gt;\r\n&quot; + 
//			&quot;	&lt;link rel=\&quot;apple-touch-icon-precomposed\&quot; href=\&quot;http://www.proximainformatica.com/wp-content/uploads/2017/09/cropped-favicon-fb-proxima-3-180x180.png\&quot; /&gt;\r\n&quot; + 
//			&quot;    &lt;link href=\&quot;https://getbootstrap.com/docs/4.1/dist/css/bootstrap.min.css\&quot; rel=\&quot;stylesheet\&quot;&gt;\r\n&quot; + 
//			&quot;	&lt;link rel=\&quot;stylesheet\&quot; type=\&quot;text/css\&quot; href=\&quot;/centauri/candidati/css/notice.css\&quot;&gt;\r\n&quot; + 
//			&quot;	&lt;link rel=\&quot;stylesheet\&quot; type=\&quot;text/css\&quot; href=\&quot;/centauri/candidati/css/style.css\&quot;&gt;	\r\n&quot; + 
//			&quot;	&lt;link rel=\&quot;stylesheet\&quot; type=\&quot;text/css\&quot; href=\&quot;/centauri/candidati/css/candidateregistration.css\&quot;&gt;\r\n&quot; + 
//			&quot;&lt;/head&gt;\r\n&quot; + 
//			&quot;&lt;body style=\&quot;margin-top: 30px;\&quot;&gt;\r\n&quot; + 
//			&quot;\r\n&quot; + 
//			&quot;	&lt;nav class=\&quot;navbar navbar-expand-md navbar-dark bg-dark fixed-top\&quot;&gt;\r\n&quot; + 
//			&quot;      &lt;a class=\&quot;navbar-brand\&quot; href=\&quot;#\&quot;&gt;\r\n&quot; + 
//			&quot;          &lt;img src=\&quot;http://www.proximainformatica.com/wp-content/uploads/2017/11/LOGO-PROXIMA-ROSSO-white-2017.png\&quot;\r\n&quot; + 
//			&quot; 				 title=\&quot;proximainformatica\&quot; id=\&quot;headerlogoproxima\&quot;&gt;\r\n&quot; + 
//			&quot;      &lt;/a&gt;\r\n&quot; + 
//			&quot;      &lt;button class=\&quot;navbar-toggler\&quot; type=\&quot;button\&quot; data-toggle=\&quot;collapse\&quot; data-target=\&quot;#navbarsExampleDefault\&quot; aria-controls=\&quot;navbarsExampleDefault\&quot; aria-expanded=\&quot;false\&quot; aria-label=\&quot;Toggle navigation\&quot;&gt;\r\n&quot; + 
//			&quot;        &lt;span class=\&quot;navbar-toggler-icon\&quot;&gt;&lt;/span&gt;\r\n&quot; + 
//			&quot;      &lt;/button&gt;\r\n&quot; + 
//			&quot;\r\n&quot; + 
//			&quot;    &lt;/nav&gt;\r\n&quot; + 
//			&quot;\r\n&quot; + 
//			&quot;\r\n&quot; + 
//			&quot;\r\n&quot; + 
//			&quot;	&lt;div class=\&quot;starter-template\&quot; ng-view&gt;&lt;/div&gt;\r\n&quot; + 
//			&quot;    &lt;footer&gt;\r\n&quot; + 
//			&quot;        &lt;img src=\&quot;/centauri/common/img/logo/footer/centauriacademy.png\&quot; id=\&quot;footerimage\&quot; title=\&quot;ProximaInformatica\&quot;&gt;\r\n&quot; + 
//			&quot;    &lt;/footer&gt;\r\n&quot; + 
//			&quot;	&lt;script src=\&quot;/centauri/common/js/ext/jquery/3.1.1/jquery-3.3.1.slim.min.js\&quot;&gt; &lt;/script&gt;\r\n&quot; + 
//			&quot;	&lt;script\r\n&quot; + 
//			&quot;	src=\&quot;https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js\&quot;\r\n&quot; + 
//			&quot;	integrity=\&quot;sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49\&quot;\r\n&quot; + 
//			&quot;	crossorigin=\&quot;anonymous\&quot;&gt;&lt;/script&gt;\r\n&quot; + 
//			&quot;&lt;script\r\n&quot; + 
//			&quot;	src=\&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js\&quot;\r\n&quot; + 
//			&quot;	integrity=\&quot;sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy\&quot;\r\n&quot; + 
//			&quot;	crossorigin=\&quot;anonymous\&quot;&gt;&lt;/script&gt;\r\n&quot;; 
//	static final String START_MESSAGE_BODY=&quot;&lt;!DOCTYPE html&gt;\r\n&quot; + 
//			&quot;&lt;html lang=\&quot;it\&quot; ng-app=\&quot;courseregistrationsystem\&quot;&gt;\r\n&quot; + 
//			&quot;&lt;head&gt;\r\n&quot; + 
//			&quot;&lt;script src=\&quot;/centauri/a/js/ext/angularjs/1.4.9/angular.js\&quot;&gt;&lt;/script&gt;\r\n&quot; + 
//			&quot;&lt;script src=\&quot;/centauri/a/js/ext/angularjs/1.4.9/angular-resource.js\&quot;&gt;&lt;/script&gt;\r\n&quot; + 
//			&quot;&lt;script src=\&quot;/centauri/a/js/ext/angularjs/1.4.9/angular-route.js\&quot;&gt;&lt;/script&gt;\r\n&quot; + 
//			&quot;&lt;script src=\&quot;/centauri/a/js/app_courses.js\&quot;&gt;&lt;/script&gt;\r\n&quot; + 
//			&quot;&lt;script src=\&quot;/centauri/a/js/coursePageController.js\&quot;&gt;&lt;/script&gt;\r\n&quot; + 
//			&quot;\r\n&quot; + 
//			&quot;\r\n&quot; + 
//			&quot;&lt;meta charset=\&quot;utf-8\&quot;&gt;\r\n&quot; + 
//			&quot;&lt;meta name=\&quot;viewport\&quot;\r\n&quot; + 
//			&quot;	content=\&quot;width=device-width, initial-scale=1, shrink-to-fit=no\&quot;&gt;\r\n&quot; + 
//			&quot;&lt;meta name=\&quot;author\&quot; content=\&quot;m.franco@proximainformatica.com\&quot;&gt;\r\n&quot; + 
//			&quot;&lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1\&quot;&gt;\r\n&quot; + 
//			&quot;&lt;meta charset=\&quot;UTF-8\&quot;&gt;\r\n&quot; + 
//			&quot;&lt;title&gt;Candidati - Corso Java - Proxima Informatica&lt;/title&gt;\r\n&quot; + 
//			&quot;&lt;meta name=\&quot;description\&quot;\r\n&quot; + 
//			&quot;	content=\&quot;Corso Java gratuito professionalizzante su Roma e Milano. A fine corso contratto a tempo indeterminato (placement 70%). Invia subito il tuo cv!\&quot; /&gt;\r\n&quot; + 
//			&quot;&lt;link rel=\&quot;icon\&quot;\r\n&quot; + 
//			&quot;	href=\&quot;http://www.proximainformatica.com/wp-content/uploads/2017/09/cropped-favicon-fb-proxima-3-32x32.png\&quot;\r\n&quot; + 
//			&quot;	sizes=\&quot;32x32\&quot; /&gt;\r\n&quot; + 
//			&quot;&lt;link rel=\&quot;icon\&quot;\r\n&quot; + 
//			&quot;	href=\&quot;http://www.proximainformatica.com/wp-content/uploads/2017/09/cropped-favicon-fb-proxima-3-192x192.png\&quot;\r\n&quot; + 
//			&quot;	sizes=\&quot;192x192\&quot; /&gt;\r\n&quot; + 
//			&quot;&lt;link rel=\&quot;apple-touch-icon-precomposed\&quot;\r\n&quot; + 
//			&quot;	href=\&quot;http://www.proximainformatica.com/wp-content/uploads/2017/09/cropped-favicon-fb-proxima-3-180x180.png\&quot; /&gt;\r\n&quot; + 
//			&quot;&lt;link\r\n&quot; + 
//			&quot;	href=\&quot;https://getbootstrap.com/docs/4.1/dist/css/bootstrap.min.css\&quot;\r\n&quot; new + 
//			&quot;	rel=\&quot;stylesheet\&quot;&gt;\r\n&quot; + 
//			&quot;&lt;link rel=\&quot;stylesheet\&quot; type=\&quot;text/css\&quot;\r\n&quot; + 
//			&quot;	href=\&quot;/centauri/candidati/css/notice.css\&quot;&gt;\r\n&quot; + 
//			&quot;&lt;link rel=\&quot;stylesheet\&quot; type=\&quot;text/css\&quot;\r\n&quot; + 
//			&quot;	href=\&quot;/centauri/candidati/css/style.css\&quot;&gt;\r\n&quot; + 
//			&quot;&lt;link rel=\&quot;stylesheet\&quot; type=\&quot;text/css\&quot;\r\n&quot; + 
//			&quot;	href=\&quot;/centauri/candidati/css/candidateregistration.css\&quot;&gt;\r\n&quot; + 
//			&quot;&lt;/head&gt;\r\n&quot; + 
//			&quot;&lt;body style=\&quot;margin-top: 30px;\&quot;&gt;\r\n&quot; + 
//			&quot;\r\n&quot; + 
//			&quot;	&lt;nav class=\&quot;navbar navbar-expand-md navbar-dark bg-dark fixed-top\&quot;&gt;\r\n&quot; + 
//			&quot;		&lt;a class=\&quot;navbar-brand\&quot; href=\&quot;#\&quot;&gt; &lt;img\r\n&quot; + 
//			&quot;			src=\&quot;http://www.proximainformatica.com/wp-content/uploads/2017/11/LOGO-PROXIMA-ROSSO-white-2017.png\&quot;\r\n&quot; + 
//			&quot;			title=\&quot;proximainformatica\&quot; id=\&quot;headerlogoproxima\&quot;&gt;\r\n&quot; + 
//			&quot;		&lt;/a&gt;\r\n&quot; + 
//			&quot;		&lt;button class=\&quot;navbar-toggler\&quot; type=\&quot;button\&quot; data-toggle=\&quot;collapse\&quot;\r\n&quot; + 
//			&quot;			data-target=\&quot;#navbarsExampleDefault\&quot;\r\n&quot; + 
//			&quot;			aria-controls=\&quot;navbarsExampleDefault\&quot; aria-expanded=\&quot;false\&quot;\r\n&quot; + 
//			&quot;			aria-label=\&quot;Toggle navigation\&quot;&gt;\r\n&quot; + 
//			&quot;			&lt;span class=\&quot;navbar-toggler-icon\&quot;&gt;&lt;/span&gt;\r\n&quot; + 
//			&quot;		&lt;/button&gt;\r\n&quot; + 
//			&quot;\r\n&quot; + 
//			&quot;	&lt;/nav&gt;\r\n&quot; + 
//			&quot;\r\n&quot; + 
//			&quot;\r\n&quot; + 
//			&quot;\r\n&quot; + 
//			&quot;	&lt;div class=\&quot;starter-template\&quot; ng-view&gt;&lt;/div&gt;\r\n&quot; + 
//			&quot;	&lt;footer&gt;\r\n&quot; + 
//			&quot;		&lt;img src=\&quot;/centauri/common/img/logo/footer/centauriacademy.png\&quot;\r\n&quot; + 
//			&quot;			id=\&quot;footerimage\&quot; title=\&quot;ProximaInformatica\&quot;&gt;\r\n&quot; + 
//			&quot;	&lt;/footer&gt;\r\n&quot; + 
//			&quot;	&lt;script\r\n&quot; + 
//			&quot;		src=\&quot;/centauri/common/js/ext/jquery/3.1.1/jquery-3.3.1.slim.min.js\&quot;&gt; &lt;/script&gt;\r\n&quot; + 
//			&quot;	&lt;script\r\n&quot; + 
//			&quot;		src=\&quot;https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js\&quot;\r\n&quot; + 
//			&quot;		integrity=\&quot;sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49\&quot;\r\n&quot; + 
//			&quot;		crossorigin=\&quot;anonymous\&quot;&gt;&lt;/script&gt;\r\n&quot; + 
//			&quot;	&lt;script\r\n&quot; + 
//			&quot;		src=\&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js\&quot;\r\n&quot; + 
//			&quot;		integrity=\&quot;sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy\&quot;\r\n&quot; + 
//			&quot;		crossorigin=\&quot;anonymous\&quot;&gt;&lt;/script&gt;&quot;;

<span class="fc" id="L175">	public static final Logger logger = LoggerFactory.getLogger(CoursePageController.class);</span>

	@Value(&quot;${app.folder.page.pubblication}&quot;)
	private String COURSE_PAGES_FOLDER;
	@Autowired
	private CoursePageRepository coursePageRepository;
	@Autowired
	private CoursePageService coursePageService;

	@Autowired
	public void setCoursePageJpaRepository(CoursePageRepository coursePageRepository) {
<span class="fc" id="L186">		this.coursePageRepository = coursePageRepository;</span>
<span class="fc" id="L187">	}</span>

	
	@GetMapping(&quot;/&quot;)
	public ResponseEntity&lt;List&lt;CoursePage&gt;&gt; listAllCoursePage() {
<span class="fc" id="L192">		List&lt;CoursePage&gt; coursePage = coursePageRepository.findAll();</span>

<span class="pc bpc" id="L194" title="1 of 2 branches missed.">		if (coursePage.isEmpty()) {</span>

<span class="nc" id="L196">			return new ResponseEntity&lt;&gt;(HttpStatus.NO_CONTENT);</span>
		}

<span class="fc" id="L199">		return new ResponseEntity&lt;&gt;(coursePage, HttpStatus.OK);</span>
	}

	@CacheEvict(value = &quot;codes&quot;, allEntries = true)
	@PostMapping(value = &quot;/&quot;, consumes = MediaType.APPLICATION_JSON_VALUE)
	public ResponseEntity&lt;CeReProAbstractEntity&gt; createCoursePage(@Valid @RequestBody final CoursePage coursePage) {

<span class="fc" id="L206">		logger.info(&quot;Creating coursePage : {}&quot;, coursePage);</span>
<span class="fc" id="L207">		coursePageRepository.save(coursePage);</span>
<span class="fc" id="L208">		return new ResponseEntity&lt;&gt;(coursePage, HttpStatus.CREATED);</span>
	}
	
	@CacheEvict(value = &quot;codes&quot;, allEntries = true)
	@PostMapping(value = &quot;/createcoursepagecustom&quot;, consumes = MediaType.APPLICATION_JSON_VALUE)
	public ResponseEntity&lt;CeReProAbstractEntity&gt; createCoursePageCustom(@Valid @RequestBody final CoursePageCustom cpc) {
		
<span class="nc" id="L215">		logger.info(&quot;Creating CoursePageCustom : {}&quot;, cpc);</span>
<span class="nc" id="L216">		CoursePageCustom dbcpc = coursePageService.insertCoursePageCustom(cpc);</span>
<span class="nc" id="L217">		return new ResponseEntity&lt;&gt;(dbcpc, HttpStatus.CREATED);</span>
		
	}
	
	
	@CacheEvict(value = &quot;codes&quot;, allEntries = true)
	@PutMapping(value = &quot;/online/{id}&quot;, consumes = MediaType.APPLICATION_JSON_VALUE)
	public ResponseEntity&lt;?&gt; setCoursePageOnline(@PathVariable final Long id) {

<span class="nc" id="L226">		logger.info(&quot;setCoursePageOnline coursePage id : {}&quot;, id);</span>
		
//		creaDirCourses();			
<span class="nc" id="L229">		Optional&lt;CoursePage&gt; current = coursePageRepository.findById(id);</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">		if (current.isPresent()) {</span>
<span class="nc" id="L231">			CoursePage currentCP = current.get();</span>
			try {
//			currentCP.setFileName(UUID.randomUUID().toString().substring(0, 5)) ;

//			String fileName = currentCP.getFileName();			
//			String fileToWrite = fileName +&quot;.html&quot; ; 
//			currentCP.setFileName(fileToWrite);

<span class="nc" id="L239">				currentCP.setFileName(&quot;index.html&quot;);</span>
<span class="nc" id="L240">				logger.info(&quot;setCoursePageOnline currentCP: {}&quot;, currentCP);</span>
<span class="nc" id="L241">				coursePageRepository.save(currentCP);</span>
<span class="nc" id="L242">				logger.info(&quot;setCoursePageOnline coursePage id : {}&quot;, id+&quot; end&quot;);</span>
<span class="nc" id="L243">				return new ResponseEntity&lt;&gt;(HttpStatus.OK);</span>
<span class="nc" id="L244">			} catch (Exception e) {</span>
<span class="nc" id="L245">				logger.error(&quot;error&quot;, e);</span>
<span class="nc" id="L246">				logger.info(&quot;setCoursePageOnline coursePage id : {}&quot;, id+&quot; end&quot;);</span>
<span class="nc" id="L247">				return new ResponseEntity&lt;&gt;(HttpStatus.CONFLICT);</span>
				
			}
		} else {
<span class="nc" id="L251">			logger.info(&quot;setCoursePageOnline coursePage id : {}&quot;, id+&quot; end&quot;);</span>
<span class="nc" id="L252">			return new ResponseEntity&lt;&gt;(HttpStatus.NOT_FOUND);</span>
		}

	}

//	@PutMapping(value = &quot;/addBodyText/{code}&quot;, consumes = MediaType.APPLICATION_JSON_VALUE)
//	public ResponseEntity&lt;?&gt; setCoursePageAddBody(@PathVariable(&quot;code&quot;) final String code) {
//
//		logger.info(&quot;setCoursePageAddBody coursePage code : {}&quot;, code);
//
////		creaDirCourses();			
//		CoursePage currentCP = coursePageRepository.findByCode(code);
//		if (currentCP != null) {
////			CoursePage currentCP = current.get();
//			try {
////			currentCP.setFileName(UUID.randomUUID().toString().substring(0, 5)) ;
//
////			String fileName = currentCP.getFileName();			
////			String fileToWrite = fileName +&quot;.html&quot; ; 
////			currentCP.setFileName(fileToWrite);
//
//				currentCP.setFileName(&quot;index.html&quot;);
//				String fileToWrite = COURSE_PAGES_FOLDER + File.separatorChar + &quot;index.html&quot;;
//				File f = new File(fileToWrite);
//
//				FileOutputStream fos = new FileOutputStream(f);
//
//				PrintWriter pw = new PrintWriter(fos);
//
//				pw.println(START_MESSAGE_BODY + currentCP.getBodyText() + FINE_INDEX);
//				pw.close();
//
//				coursePageRepository.save(currentCP);
//				return new ResponseEntity&lt;&gt;(HttpStatus.OK);
//			} catch (Exception e) {
//				logger.error(&quot;error&quot;, e);
//				return new ResponseEntity&lt;&gt;(HttpStatus.CONFLICT);
//			}
//		} else {
//			return new ResponseEntity&lt;&gt;(HttpStatus.NOT_FOUND);
//		}
//
//	}
	
	//metodo get copiato da user
	@GetMapping(value = &quot;/getBodyText/{code}&quot;)
	public ResponseEntity&lt;?&gt; getCoursePageByCode(@PathVariable final String code) {
<span class="nc" id="L299">		logger.info(&quot;getCoursePageByCode coursePage code : {}&quot;, code);</span>
		
<span class="nc" id="L301">		CoursePage currentCP = coursePageRepository.findByCode(code);</span>
<span class="nc" id="L302">		logger.info(&quot;getCoursePageByCode coursePage code : {} begin&quot;, code);</span>
<span class="nc bnc" id="L303" title="All 2 branches missed.">		if (currentCP!=null) {</span>
<span class="nc" id="L304">			logger.info(&quot;getCoursePageByCode coursePage code : {} end&quot;, code);</span>
<span class="nc" id="L305">			return new ResponseEntity&lt;CoursePage&gt;(currentCP, HttpStatus.OK);</span>
			
		} else {
<span class="nc" id="L308">			logger.info(&quot;getCoursePageByCode coursePage code : {} end&quot;, code);</span>
<span class="nc" id="L309">			return new ResponseEntity&lt;&gt;(HttpStatus.NOT_FOUND);</span>
		}
		

	}

	@PutMapping(value = &quot;/offline/{id}&quot;, consumes = MediaType.APPLICATION_JSON_VALUE)
	public ResponseEntity&lt;?&gt; setCoursePageOffline(@PathVariable final Long id) {

<span class="nc" id="L318">		logger.info(&quot;setCoursePageOnline coursePage id : {}&quot;, id+&quot; begin&quot;);</span>

//		creaDirCourses();			
<span class="nc" id="L321">		Optional&lt;CoursePage&gt; current = coursePageRepository.findById(id);</span>
<span class="nc bnc" id="L322" title="All 2 branches missed.">		if (current.isPresent()) {</span>
<span class="nc" id="L323">			CoursePage currentCP = current.get();</span>
			try {
//			currentCP.setFileName(UUID.randomUUID().toString().substring(0, 5)) ;

//			String fileName = currentCP.getFileName();			
//			String fileToWrite = fileName +&quot;.html&quot; ; 
//			currentCP.setFileName(fileToWrite);

<span class="nc" id="L331">				currentCP.setFileName(null);</span>
<span class="nc" id="L332">				coursePageRepository.save(currentCP);</span>
<span class="nc" id="L333">				logger.info(&quot;setCoursePageOnline coursePage id : {}&quot;, id+&quot; end&quot;);</span>
<span class="nc" id="L334">				return new ResponseEntity&lt;&gt;(HttpStatus.OK);</span>
<span class="nc" id="L335">			} catch (Exception e) {</span>
<span class="nc" id="L336">				logger.error(&quot;error&quot;, e);</span>
<span class="nc" id="L337">				logger.info(&quot;setCoursePageOnline coursePage id : {}&quot;, id+&quot; end&quot;);</span>
<span class="nc" id="L338">				return new ResponseEntity&lt;&gt;(HttpStatus.CONFLICT);</span>
				
			}
		} else {
<span class="nc" id="L342">			logger.info(&quot;setCoursePageOnline coursePage id : {}&quot;, id+&quot; end&quot;);</span>
<span class="nc" id="L343">			return new ResponseEntity&lt;&gt;(HttpStatus.NOT_FOUND);</span>
		}
	}

	@GetMapping(&quot;/{id}&quot;)
	public ResponseEntity&lt;CeReProAbstractEntity&gt; getCoursePageById(@PathVariable final Long id) {
<span class="fc" id="L349">		Optional&lt;CoursePage&gt; coursePage = coursePageRepository.findById(id);</span>

<span class="pc bpc" id="L351" title="1 of 2 branches missed.">		if (coursePage.isEmpty()) {</span>

<span class="nc" id="L353">			return new ResponseEntity&lt;&gt;(new CustomErrorType(&quot;CoursePage with id &quot; + id + &quot; not found&quot;),</span>
					HttpStatus.NOT_FOUND);
		}

<span class="fc" id="L357">		return new ResponseEntity&lt;&gt;(coursePage.get(), HttpStatus.OK);</span>
	}

	@PutMapping(value = &quot;/{id}&quot;, consumes = MediaType.APPLICATION_JSON_VALUE)
	public ResponseEntity&lt;CeReProAbstractEntity&gt; updateCoursePage(@PathVariable final Long id,
			@RequestBody CoursePage coursePage) {

<span class="fc" id="L364">		Optional&lt;CoursePage&gt; currentCoursePage = coursePageRepository.findById(id);</span>

<span class="pc bpc" id="L366" title="1 of 2 branches missed.">		if (currentCoursePage.isEmpty()) {</span>
<span class="nc" id="L367">			return new ResponseEntity&lt;&gt;(</span>
					new CustomErrorType(&quot;Unable to update. CoursePage with id &quot; + id + &quot; not found.&quot;),
					HttpStatus.NOT_FOUND);
		}

<span class="fc" id="L372">		currentCoursePage.get().setOpened_by(coursePage.getOpened_by());</span>
<span class="fc" id="L373">		currentCoursePage.get().setFileName(coursePage.getFileName());</span>
<span class="fc" id="L374">		currentCoursePage.get().setTitle(coursePage.getTitle());</span>
<span class="fc" id="L375">		currentCoursePage.get().setCode(coursePage.getCode());</span>
<span class="fc" id="L376">		currentCoursePage.get().setBodyText(coursePage.getBodyText());</span>
<span class="fc" id="L377">		currentCoursePage.get().setId(coursePage.getId());</span>
<span class="fc" id="L378">		currentCoursePage.get().setCreated_datetime(coursePage.getCreated_datetime());</span>

<span class="fc" id="L380">		coursePageRepository.saveAndFlush(currentCoursePage.get());</span>

<span class="fc" id="L382">		return new ResponseEntity&lt;&gt;(currentCoursePage.get(), HttpStatus.OK);</span>
	}

	@CacheEvict(value = &quot;codes&quot;, allEntries = true)
	@DeleteMapping(&quot;/{id}&quot;)
	public ResponseEntity&lt;CeReProAbstractEntity&gt; deleteCoursePage(@PathVariable final Long id) {
<span class="fc" id="L388">		Optional&lt;CoursePage&gt; coursePage = coursePageRepository.findById(id);</span>
<span class="pc bpc" id="L389" title="1 of 2 branches missed.">		if (coursePage.isEmpty()) {</span>
<span class="nc" id="L390">			return new ResponseEntity&lt;&gt;(</span>
					new CustomErrorType(&quot;Unable to delete. CoursePage with id &quot; + id + &quot; not found.&quot;),
					HttpStatus.NOT_FOUND);
		}
		try {			
<span class="fc" id="L395">			coursePageRepository.delete(coursePage.get());</span>
<span class="fc" id="L396">			return new ResponseEntity&lt;&gt;(HttpStatus.NO_CONTENT);</span>
<span class="nc" id="L397">		} catch (DataIntegrityViolationException e) {</span>
<span class="nc" id="L398">			logger.warn(e.getMessage(), e);</span>
<span class="nc" id="L399">			String constraintViolationMessage = messageSource.getMessage(&quot;coursepage.error.delete.not.executed.contraint.violation&quot;, null, LocaleContextHolder.getLocale());</span>
<span class="nc" id="L400">			return new ResponseEntity&lt;CeReProAbstractEntity&gt;(new CustomErrorType(constraintViolationMessage)  , HttpStatus.INTERNAL_SERVER_ERROR);</span>
<span class="nc" id="L401">		} catch (Exception e) {</span>
<span class="nc" id="L402">			logger.error(e.getMessage(), e);</span>
<span class="nc" id="L403">			return new ResponseEntity&lt;CeReProAbstractEntity&gt;(new CustomErrorType(e.getMessage())  , HttpStatus.INTERNAL_SERVER_ERROR);</span>
		}
	}

	@DeleteMapping(value = &quot;/deleteFile/{id}&quot;, consumes = MediaType.APPLICATION_JSON_VALUE)
	public ResponseEntity deleteFile(@PathVariable final Long id) throws FileNotFoundException {

<span class="nc" id="L410">		Optional&lt;CoursePage&gt; current = coursePageRepository.findById(id);</span>
<span class="nc" id="L411">		logger.info(&quot;setCoursePageOffline coursePage id : {}&quot;, id);</span>

//		creaDirCourses();			

<span class="nc" id="L415">		CoursePage cp = new CoursePage();</span>
<span class="nc" id="L416">		String fileName = cp.getFileName();</span>
<span class="nc" id="L417">		String fileToDelete = COURSE_PAGES_FOLDER + File.separatorChar + fileName + &quot;.html&quot;;//</span>

<span class="nc" id="L419">		File f = new File(fileToDelete);</span>

<span class="nc bnc" id="L421" title="All 2 branches missed.">		if (!f.exists())</span>
<span class="nc" id="L422">			throw new IllegalArgumentException(&quot;Il File o la Directory non esiste: &quot; + fileToDelete);</span>

<span class="nc bnc" id="L424" title="All 2 branches missed.">		if (!f.canWrite())</span>
<span class="nc" id="L425">			throw new IllegalArgumentException(&quot;Non ho il permesso di scrittura: &quot; + fileToDelete);</span>

<span class="nc" id="L427">		boolean success = f.delete();</span>

<span class="nc bnc" id="L429" title="All 2 branches missed.">		if (!success)</span>
<span class="nc" id="L430">			throw new IllegalArgumentException(&quot;Cancellazione fallita&quot;);</span>

<span class="nc" id="L432">		return new ResponseEntity&lt;&gt;(current.get(), HttpStatus.OK);</span>

	}

	private boolean deleteCoursePageFile(CoursePage cp) {

<span class="nc" id="L438">		logger.info(&quot;deleteCoursePageFile coursePage : {}&quot;, cp);</span>

//		creaDirCourses();			

<span class="nc" id="L442">		String fileName = &quot;index.html&quot;;</span>

<span class="nc" id="L444">		String fileToDelete = COURSE_PAGES_FOLDER + File.separatorChar + fileName;// + &quot;.html&quot;</span>

<span class="nc" id="L446">		File f = new File(fileToDelete);</span>

<span class="nc bnc" id="L448" title="All 2 branches missed.">		if (!f.exists())</span>
<span class="nc" id="L449">			throw new IllegalArgumentException(&quot;Il File o la Directory non esiste: &quot; + fileToDelete);</span>

<span class="nc bnc" id="L451" title="All 2 branches missed.">		if (!f.canWrite())</span>
<span class="nc" id="L452">			throw new IllegalArgumentException(&quot;Non ho il permesso di scrittura: &quot; + fileToDelete);</span>

<span class="nc" id="L454">		boolean success = f.delete();</span>

<span class="nc bnc" id="L456" title="All 2 branches missed.">		if (!success)</span>
<span class="nc" id="L457">			throw new IllegalArgumentException(&quot;Cancellazione fallita&quot;);</span>

<span class="nc" id="L459">		return success;</span>

	}
	@Cacheable(&quot;codes&quot;)
	@GetMapping(&quot;/codes&quot;)
	public ResponseEntity&lt;List&lt;CustomCode&gt;&gt; listAllCourseCode() {
<span class="nc" id="L465">		List&lt;CoursePage&gt; coursePage = coursePageRepository.findAll(Sort.by(Sort.Direction.ASC, &quot;code&quot;));</span>
		

<span class="nc bnc" id="L468" title="All 2 branches missed.">		if (coursePage.size()==0) {</span>

<span class="nc" id="L470">			return new ResponseEntity&lt;&gt;(HttpStatus.NO_CONTENT);</span>
		}
		else
		{	
<span class="nc" id="L474">			List&lt;CustomCode&gt; codes= new ArrayList&lt;CustomCode&gt;();</span>
<span class="nc" id="L475">			CustomCode currentCustomCode= new CustomCode();</span>
//			coursePage.stream().forEach((x)-&gt;currentCustomCode.setCode(x.getCode()));
//			coursePage.stream().forEach((y)-&gt;codes.add(currentCustomCode));
		
			
<span class="nc bnc" id="L480" title="All 2 branches missed.">			for(CoursePage a: coursePage)</span>
			{
<span class="nc" id="L482">				String code= a.getCode();</span>
<span class="nc" id="L483">				currentCustomCode= new CustomCode();</span>
<span class="nc" id="L484">				System.out.println(code);</span>
<span class="nc" id="L485">				currentCustomCode.setCode(code);</span>
<span class="nc" id="L486">				System.out.println(currentCustomCode.getCode());</span>
<span class="nc" id="L487">				codes.add(currentCustomCode);</span>
				
<span class="nc" id="L489">			}</span>
			
			
<span class="nc" id="L492">			return new ResponseEntity&lt;&gt;(codes,HttpStatus.OK);</span>
		}
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>